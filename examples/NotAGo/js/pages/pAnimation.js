var pAnimation={init:function(){var e,n,i,t,o,a,r,d,l;console.log("<pAnimation> => INIT!"),$(window).on("resize",this.onResize),this.onResize(),!1===WEBGL.isWebGLAvailable()&&document.body.appendChild(WEBGL.getWebGLErrorMessage());var s=new THREE.Clock,p=[];function c(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}function h(e,n,i){PRELOADER.show(),(new THREE.TextureLoader).load(n,function(n){console.log(n),d.load(e,function(e){l&&(o.remove(l),p.shift(),l=null,e.mixer=null);for(var t=0;t<e.children.length;t++){var a=e.children[t];a.type.toLowerCase().includes("mesh")&&(a.material.color={r:1,g:1,b:1})}e.traverse(function(e){e.isMesh&&(e.material.map=n,e.material.map.needsUpdate=!0,e.material.needsUpdate=!0,e.material.shininess=0)}),e.mixer=new THREE.AnimationMixer(e),p.push(e.mixer),e.mixer.clipAction(e.animations[0]).play(),o.add(e),l=e,PRELOADER.hide(),i&&i(e)})})}!function(){e=document.createElement("div"),document.body.appendChild(e),d=new THREE.FBXLoader,(t=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,5e3)).position.set(0,300,700),(o=new THREE.Scene).background=new THREE.Color(10526880),(r=new THREE.HemisphereLight(16777147,526368)).intensity=.4,r.position.set(1e3,10,1e3),o.add(r);var l=new THREE.HemisphereLightHelper(r,5);o.add(l),(new THREE.Object3D).position.set(0,200,0),(r=new THREE.DirectionalLight(16777215)).position.set(0,500,500),o.add(r);var s=new THREE.Mesh(new THREE.PlaneBufferGeometry(2e3,2e3),new THREE.MeshPhongMaterial({color:10066329,depthWrite:!1}));s.rotation.x=-Math.PI/2,s.receiveShadow=!0;var p=new THREE.GridHelper(4e3,20,0,0);p.material.opacity=.2,p.material.transparent=!0,o.add(p),h("uploads/model.fbx","uploads/texture.jpg"),PRELOADER.hide(),(a=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),a.shadowMap.enabled=!0,e.appendChild(a.domElement),window.addEventListener("resize",c,!1),n=new Stats,e.appendChild(n.dom),n.dom.left="auto",n.dom.right=0,(i=new THREE.TrackballControls(t,a.domElement)).target.set(0,100,0),i.rotateSpeed=.5,i.zoomSpeed=.5,i.panSpeed=.5}(),function e(){requestAnimationFrame(e);var r=s.getDelta();if(p.length>0)for(var d=0;d<p.length;d++)p[d].update(r);a&&a.render(o,t);n&&n.update();i&&i.update(r)}(),$(function(){$(".btn-upload").click(function(e){e.preventDefault();var n=$("#fbxFile").prop("files")[0],i=$("#textureFile").prop("files")[0];if(n)if(i){var t=new FormData;t.append("fbxfile",n),t.append("texturefile",i);var o="dev4.digitop.vn"==location.host?"https://dev4.digitop.vn/demo/coca-animation/":"http://localhost/arjs-demo/debug/";$.ajax({url:o+"upload.php",dataType:"text",cache:!1,contentType:!1,processData:!1,data:t,type:"post",success:function(e){h("uploads/model.fbx","uploads/texture.jpg")}})}else alert("Vui lòng chọn file TEXTURE");else alert("Vui lòng chọn file FBX")})})},onResize:function(e){console.log("Browser size: "+window.innerWidth+"x"+window.innerHeight)},galleryInit:function(){}};