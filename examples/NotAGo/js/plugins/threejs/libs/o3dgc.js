var o3dgc=function(){"use strict";var t,e;function i(t,i,r,o){var n,_,m,a,s,h;for(n=-1,_=!1,a=i.m_value,0,m=0;m<a;++m){if(t.Equal(r[m].m_id)){_=!0;break}if(t.Less(r[m].m_id)){for(i.m_value<e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&++i.m_value,s=i.m_value-1;s>m;--s)for(r[s].m_id.m_a=r[s-1].m_id.m_a,r[s].m_id.m_b=r[s-1].m_id.m_b,r[s].m_id.m_c=r[s-1].m_id.m_c,h=0;h<o;++h)r[s].m_pred[h]=r[s-1].m_pred[h];r[m].m_id.m_a=t.m_a,r[m].m_id.m_b=t.m_b,r[m].m_id.m_c=t.m_c,n=m,_=!0;break}}return!_&&i.m_value<e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&(r[n=i.m_value++].m_id.m_a=t.m_a,r[n].m_id.m_b=t.m_b,r[n].m_id.m_c=t.m_c),n}function r(t){return 1&t?-(t+1>>>1):t>>>1}function o(e,r,o,n,_,m,a,s){var h,d,u,c,C,l;for(l=new t.SC3DMCTriplet(-1,-1,-1),d=0;d<3;++d)if((c=e[3*r+d])<o&&(l.m_a=-1,l.m_b=-1,l.m_c=c,-1!==(u=i(l,n,_,m))))for(h=c*s,C=0;C<m;++C)_[u].m_pred[C]=a[h+C]}function n(e,r,o,n,_,m,a,s,h,d){var u,c,C,l,A,f,p,D,S,I,T,y,O,G,M,N,R,b;if(u=3*r,b=new t.SC3DMCTriplet(-1,-1,-1),e[u]===o?(f=e[u+1],p=e[u+2]):e[u+1]===o?(f=e[u],p=e[u+2]):(f=e[u],p=e[u+1]),f<o&&p<o)for(y=h.Begin(f),O=h.End(f),G=y;G<O&&!((M=d[G])<0);++G){for(c=3*M,D=-1,N=!1,T=0;T<3;++T)(S=e[c+T])===p?N=!0:S<o&&S!==f&&(D=S);if(-1!==D&&N&&(f<p?(b.m_a=f,b.m_b=p):(b.m_a=p,b.m_b=f),b.m_c=-D-1,-1!==(R=i(b,n,_,m))))for(C=f*s,l=p*s,A=D*s,I=0;I<m;++I)_[R].m_pred[I]=a[C+I]+a[l+I]-a[A+I]}}return t={},(e={}).O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0=7,e.O3DGC_BINARY_STREAM_MAX_SYMBOL0=127,e.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1=6,e.O3DGC_BINARY_STREAM_MAX_SYMBOL1=63,e.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32=5,e.O3DGC_BIG_ENDIAN=0,e.O3DGC_LITTLE_ENDIAN=1,e.O3DGC_MAX_DOUBLE=1.79769e308,e.O3DGC_MIN_LONG=-2147483647,e.O3DGC_MAX_LONG=2147483647,e.O3DGC_MAX_UCHAR8=255,e.O3DGC_MAX_TFAN_SIZE=256,e.O3DGC_MAX_ULONG=4294967295,e.O3DGC_SC3DMC_START_CODE=497,e.O3DGC_DV_START_CODE=498,e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES=256,e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES=256,e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES=32,e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS=2,e.O3DGC_SC3DMC_BINARIZATION_FL=0,e.O3DGC_SC3DMC_BINARIZATION_BP=1,e.O3DGC_SC3DMC_BINARIZATION_FC=2,e.O3DGC_SC3DMC_BINARIZATION_AC=3,e.O3DGC_SC3DMC_BINARIZATION_AC_EGC=4,e.O3DGC_SC3DMC_BINARIZATION_ASCII=5,e.O3DGC_STREAM_TYPE_UNKOWN=0,e.O3DGC_STREAM_TYPE_ASCII=1,e.O3DGC_STREAM_TYPE_BINARY=2,e.O3DGC_SC3DMC_NO_PREDICTION=0,e.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION=1,e.O3DGC_SC3DMC_XOR_PREDICTION=2,e.O3DGC_SC3DMC_ADAPTIVE_DIFFERENTIAL_PREDICTION=3,e.O3DGC_SC3DMC_CIRCULAR_DIFFERENTIAL_PREDICTION=4,e.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION=5,e.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION=6,e.O3DGC_SC3DMC_ENCODE_MODE_QBCR=0,e.O3DGC_SC3DMC_ENCODE_MODE_SVA=1,e.O3DGC_SC3DMC_ENCODE_MODE_TFAN=2,e.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT=0,e.O3DGC_MIN_NEIGHBORS_SIZE=128,e.O3DGC_MIN_NUM_NEIGHBORS_SIZE=16,e.O3DGC_TFANS_MIN_SIZE_ALLOCATED_VERTICES_BUFFER=128,e.O3DGC_TFANS_MIN_SIZE_TFAN_SIZE_BUFFER=8,e.O3DGC_DEFAULT_VECTOR_SIZE=32,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_UNKOWN=0,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_POSITION=1,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_NORMAL=2,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_COLOR=3,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_TEXCOORD=4,t.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_WEIGHT=5,t.O3DGC_IFS_INT_ATTRIBUTE_TYPE_UNKOWN=0,t.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX=1,t.O3DGC_IFS_INT_ATTRIBUTE_TYPE_JOINT_ID=2,t.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX_BUFFER_ID=3,t.O3DGC_OK=0,t.O3DGC_ERROR_BUFFER_FULL=1,t.O3DGC_ERROR_CORRUPTED_STREAM=5,t.O3DGC_ERROR_NON_SUPPORTED_FEATURE=6,t.O3DGC_ERROR_AC=7,t.SC3DMCStats=function(){this.m_timeCoord=0,this.m_timeNormal=0,this.m_timeCoordIndex=0,this.m_timeFloatAttribute=new Float32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_timeIntAttribute=new Float32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_timeReorder=0,this.m_streamSizeCoord=0,this.m_streamSizeNormal=0,this.m_streamSizeCoordIndex=0,this.m_streamSizeFloatAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_streamSizeIntAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES)},t.SC3DMCTriplet=function(t,e,i){this.m_a=t,this.m_b=e,this.m_c=i},t.SC3DMCTriplet.prototype.Less=function(t){return this.m_c!==t.m_c?this.m_c<t.m_c:this.m_b!==t.m_b?this.m_b<t.m_b:this.m_a<t.m_a},t.SC3DMCTriplet.prototype.Equal=function(t){return this.m_c===t.m_c&&this.m_b===t.m_b&&this.m_a===t.m_a},t.SC3DMCPredictor=function(){this.m_id=new t.SC3DMCTriplet(-1,-1,-1),this.m_pred=new Float32Array(e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES)},void 0===window.performance&&(window.performance={}),window.performance.now||(e.nowOffset=Date.now(),performance.timing&&performance.timing.navigationStart&&(e.nowOffset=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e.nowOffset}),t.Timer=function(){this.m_start=0,this.m_end=0},t.Timer.prototype.Tic=function(){this.m_start=window.performance.now()},t.Timer.prototype.Toc=function(){this.m_end=window.performance.now()},t.Timer.prototype.GetElapsedTime=function(){return this.m_end-this.m_start},t.Vec3=function(t,e,i){this.m_x=t,this.m_y=e,this.m_z=i},t.Vec3.prototype.Set=function(t,e,i){this.m_x=t,this.m_y=e,this.m_z=i},t.Vec3.prototype.Sub=function(t,e){this.m_x=t.m_x-e.m_x,this.m_y=t.m_y-e.m_y,this.m_z=t.m_z-e.m_z},t.Vec3.prototype.Add=function(t,e){this.m_x=t.m_x+e.m_x,this.m_y=t.m_y+e.m_y,this.m_z=t.m_z+e.m_z},t.Vec3.prototype.SelfAdd=function(t){this.m_x+=t.m_x,this.m_y+=t.m_y,this.m_z+=t.m_z},t.Vec3.prototype.Cross=function(t,e){this.m_x=t.m_y*e.m_z-t.m_z*e.m_y,this.m_y=t.m_z*e.m_x-t.m_x*e.m_z,this.m_z=t.m_x*e.m_y-t.m_y*e.m_x},t.Vec3.prototype.GetNorm=function(){return Math.sqrt(this.m_x*this.m_x+this.m_y*this.m_y+this.m_z*this.m_z)},e.CubeToSphere={0:function(t,e){e.m_x=t.m_x,e.m_y=t.m_y,e.m_z=Math.sqrt(Math.max(0,1-e.m_x*e.m_x-e.m_y*e.m_y))},1:function(t,e){e.m_x=-t.m_x,e.m_y=-t.m_y,e.m_z=-Math.sqrt(Math.max(0,1-e.m_x*e.m_x-e.m_y*e.m_y))},2:function(t,e){e.m_z=t.m_x,e.m_x=t.m_y,e.m_y=Math.sqrt(Math.max(0,1-e.m_x*e.m_x-e.m_z*e.m_z))},3:function(t,e){e.m_z=-t.m_x,e.m_x=-t.m_y,e.m_y=-Math.sqrt(Math.max(0,1-e.m_x*e.m_x-e.m_z*e.m_z))},4:function(t,e){e.m_y=t.m_x,e.m_z=t.m_y,e.m_x=Math.sqrt(Math.max(0,1-e.m_y*e.m_y-e.m_z*e.m_z))},5:function(t,e){e.m_y=-t.m_x,e.m_z=-t.m_y,e.m_x=-Math.sqrt(Math.max(0,1-e.m_y*e.m_y-e.m_z*e.m_z))}},t.Iterator=function(){this.m_count=0},t.NumberRef=function(){this.m_value=0},t.BinaryStream=function(t){var i,r,o;this.m_endianness=(r=new ArrayBuffer(4),i=new Uint32Array(r),o=new Uint8Array(r),i[0]=1,1===o[0]?e.O3DGC_LITTLE_ENDIAN:e.O3DGC_BIG_ENDIAN),this.m_buffer=t,this.m_stream=new Uint8Array(this.m_buffer),this.m_localBuffer=new ArrayBuffer(4),this.m_localBufferViewUChar8=new Uint8Array(this.m_localBuffer),this.m_localBufferViewFloat32=new Float32Array(this.m_localBuffer),this.m_localBufferViewUInt32=new Uint32Array(this.m_localBuffer)},t.BinaryStream.prototype.ReadFloat32Bin=function(t){return this.m_endianness===e.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[t.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[t.m_count++]),this.m_localBufferViewFloat32[0]},t.BinaryStream.prototype.ReadUInt32Bin=function(t){return this.m_endianness===e.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[t.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[t.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[t.m_count++]),this.m_localBufferViewUInt32[0]},t.BinaryStream.prototype.ReadUChar8Bin=function(t){return this.m_stream[t.m_count++]},t.BinaryStream.prototype.ReadUInt32ASCII=function(t){var i,r,o;for(i=0,r=0,o=0;o<e.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32;++o)i+=this.m_stream[t.m_count++]<<r>>>0,r+=e.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;return i},t.BinaryStream.prototype.ReadFloat32ASCII=function(t){var i=this.ReadUInt32ASCII(t);return this.m_endianness===e.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[0]=i&e.O3DGC_MAX_UCHAR8):(this.m_localBufferViewUChar8[0]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&e.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[3]=i&e.O3DGC_MAX_UCHAR8),this.m_localBufferViewFloat32[0]},t.BinaryStream.prototype.ReadIntASCII=function(t){return r(this.ReadUIntASCII(t))},t.BinaryStream.prototype.ReadUIntASCII=function(t){var i,r,o;if((o=this.m_stream[t.m_count++])===e.O3DGC_BINARY_STREAM_MAX_SYMBOL0){i=0;do{o+=(r=this.m_stream[t.m_count++])>>>1<<i>>>0,i+=e.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1}while(1&r)}return o},t.BinaryStream.prototype.ReadUCharASCII=function(t){return this.m_stream[t.m_count++]},t.BinaryStream.prototype.ReadFloat32=function(t,i){return i===e.O3DGC_STREAM_TYPE_ASCII?this.ReadFloat32ASCII(t):this.ReadFloat32Bin(t)},t.BinaryStream.prototype.ReadUInt32=function(t,i){return i===e.O3DGC_STREAM_TYPE_ASCII?this.ReadUInt32ASCII(t):this.ReadUInt32Bin(t)},t.BinaryStream.prototype.ReadUChar=function(t,i){return i===e.O3DGC_STREAM_TYPE_ASCII?this.ReadUCharASCII(t):this.ReadUChar8Bin(t)},t.BinaryStream.prototype.GetBuffer=function(t,e){return new Uint8Array(this.m_buffer,t.m_count,e)},e.O3DGC_AC_MIN_LENGTH=16777216,e.O3DGC_AC_MAX_LENGTH=4294967295,e.O3DGC_AC_BM_LENGTH_SHIFT=13,e.O3DGC_AC_BM_MAX_COUNT=1<<e.O3DGC_AC_BM_LENGTH_SHIFT>>>0,e.O3DGC_AC_DM_LENGTH_SHIFT=15,e.O3DGC_AC_DM_MAX_COUNT=1<<e.O3DGC_AC_DM_LENGTH_SHIFT>>>0,t.StaticBitModel=function(){this.m_bit0Prob=1<<e.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0},t.StaticBitModel.prototype.SetProbability=function(t){this.m_bit0Prob=Math.floor(t*(1<<e.O3DGC_AC_BM_LENGTH_SHIFT>>>0))},t.AdaptiveBitModel=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<e.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},t.AdaptiveBitModel.prototype.Reset=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<e.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},t.AdaptiveBitModel.prototype.Update=function(){(this.m_bitCount+=this.m_updateCycle)>e.O3DGC_AC_BM_MAX_COUNT&&(this.m_bitCount=this.m_bitCount+1>>>1,this.m_bit0Count=this.m_bit0Count+1>>>1,this.m_bit0Count===this.m_bitCount&&++this.m_bitCount);var t=Math.floor(2147483648/this.m_bitCount);this.m_bit0Prob=this.m_bit0Count*t>>>31-e.O3DGC_AC_BM_LENGTH_SHIFT,this.m_updateCycle=5*this.m_updateCycle>>>2,this.m_updateCycle>64&&(this.m_updateCycle=64),this.m_bitsUntilUpdate=this.m_updateCycle},t.AdaptiveDataModel=function(){this.m_buffer={},this.m_distribution={},this.m_symbolCount={},this.m_decoderTable={},this.m_totalCount=0,this.m_updateCycle=0,this.m_symbolsUntilUpdate=0,this.m_dataSymbols=0,this.m_lastSymbol=0,this.m_tableSize=0,this.m_tableShift=0},t.AdaptiveDataModel.prototype.Update=function(){var t,i,r,o,n,_,m;if((this.m_totalCount+=this.m_updateCycle)>e.O3DGC_AC_DM_MAX_COUNT)for(this.m_totalCount=0,t=0;t<this.m_dataSymbols;++t)this.m_totalCount+=this.m_symbolCount[t]=this.m_symbolCount[t]+1>>>1;if(i=0,r=0,o=Math.floor(2147483648/this.m_totalCount),0===this.m_tableSize)for(n=0;n<this.m_dataSymbols;++n)this.m_distribution[n]=o*i>>>31-e.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[n];else{for(n=0;n<this.m_dataSymbols;++n)for(this.m_distribution[n]=o*i>>>31-e.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[n],m=this.m_distribution[n]>>>this.m_tableShift;r<m;)this.m_decoderTable[++r]=n-1;for(this.m_decoderTable[0]=0;r<=this.m_tableSize;)this.m_decoderTable[++r]=this.m_dataSymbols-1}this.m_updateCycle=5*this.m_updateCycle>>>2,_=this.m_dataSymbols+6<<3>>>0,this.m_updateCycle>_&&(this.m_updateCycle=_),this.m_symbolsUntilUpdate=this.m_updateCycle},t.AdaptiveDataModel.prototype.Reset=function(){var t;if(0!==this.m_dataSymbols){for(this.m_totalCount=0,this.m_updateCycle=this.m_dataSymbols,t=0;t<this.m_dataSymbols;++t)this.m_symbolCount[t]=1;this.Update(),this.m_symbolsUntilUpdate=this.m_updateCycle=this.m_dataSymbols+6>>>1}},t.AdaptiveDataModel.prototype.SetAlphabet=function(i){if(i<2||i>2048)return Console.log("invalid number of data symbols"),t.O3DGC_ERROR_AC;if(this.m_dataSymbols!==i)if(this.m_dataSymbols=i,this.m_lastSymbol=this.m_dataSymbols-1,this.m_dataSymbols>16){for(var r=3;this.m_dataSymbols>1<<r+2>>>0;)++r;this.m_tableSize=1<<r>>>0,this.m_tableShift=e.O3DGC_AC_DM_LENGTH_SHIFT-r,this.m_buffer=new ArrayBuffer(4*(2*this.m_dataSymbols+this.m_tableSize+2)),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable=new Uint32Array(this.m_buffer,8*this.m_dataSymbols,this.m_tableSize+2)}else this.m_tableSize=this.m_tableShift=0,this.m_buffer=new ArrayBuffer(8*this.m_dataSymbols),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable={};return this.Reset(),t.O3DGC_OK},t.ArithmeticDecoder=function(){this.m_codeBuffer={},this.m_acShift=0,this.m_base=0,this.m_value=0,this.m_length=0,this.m_bufferSize=0,this.m_mode=0},t.ArithmeticDecoder.prototype.SetBuffer=function(e,i){return 0===e?(Console.log("invalid codec buffer size"),t.O3DGC_ERROR_AC):0!==this.m_mode?(Console.log("cannot set buffer while encoding or decoding"),t.O3DGC_ERROR_AC):(this.m_bufferSize=e,void(this.m_codeBuffer=i))},t.ArithmeticDecoder.prototype.StartDecoder=function(){return 0!==this.m_mode?(Console.log("cannot start decoder"),t.O3DGC_ERROR_AC):0===this.m_bufferSize?(Console.log("no code buffer set"),t.O3DGC_ERROR_AC):(this.m_mode=2,this.m_length=e.O3DGC_AC_MAX_LENGTH,this.m_acShift=3,void(this.m_value=(this.m_codeBuffer[0]<<24|this.m_codeBuffer[1]<<16|this.m_codeBuffer[2]<<8|this.m_codeBuffer[3])>>>0))},t.ArithmeticDecoder.prototype.StopDecoder=function(){if(2!==this.m_mode)return Console.log("invalid to stop decoder"),t.O3DGC_ERROR_AC;this.m_mode=0},t.ArithmeticDecoder.prototype.GetBit=function(){this.m_length>>>=1;var t=this.m_value>=this.m_length;return t&&(this.m_value-=this.m_length),this.m_length<e.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),t},t.ArithmeticDecoder.prototype.GetBits=function(t){var i=Math.floor(this.m_value/(this.m_length>>>=t));return this.m_value-=this.m_length*i,this.m_length<e.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),i},t.ArithmeticDecoder.prototype.DecodeStaticBitModel=function(t){var i,r;return i=t.m_bit0Prob*(this.m_length>>>e.O3DGC_AC_BM_LENGTH_SHIFT),(r=this.m_value>=i)?(this.m_value-=i,this.m_length-=i):this.m_length=i,this.m_length<e.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),r},t.ArithmeticDecoder.prototype.DecodeAdaptiveBitModel=function(t){var i,r;return i=t.m_bit0Prob*(this.m_length>>>e.O3DGC_AC_BM_LENGTH_SHIFT),(r=this.m_value>=i)?(this.m_value-=i,this.m_length-=i):(this.m_length=i,++t.m_bit0Count),this.m_length<e.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),0==--t.m_bitsUntilUpdate&&t.Update(),r},t.ArithmeticDecoder.prototype.DecodeAdaptiveDataModel=function(t){var i,r,o,n,_,m,a,s;if(n=this.m_length,t.m_tableSize>0){for(_=(m=Math.floor(this.m_value/(this.m_length>>>=e.O3DGC_AC_DM_LENGTH_SHIFT)))>>>t.m_tableShift,r=t.m_decoderTable[_],i=t.m_decoderTable[_+1]+1;i>r+1;)s=r+i>>>1,t.m_distribution[s]>m?i=s:r=s;o=t.m_distribution[r]*this.m_length,r!==t.m_lastSymbol&&(n=t.m_distribution[r+1]*this.m_length)}else{o=r=0,this.m_length>>>=e.O3DGC_AC_DM_LENGTH_SHIFT,s=(i=t.m_dataSymbols)>>>1;do{(a=this.m_length*t.m_distribution[s])>this.m_value?(i=s,n=a):(r=s,o=a)}while((s=r+i>>>1)!==r)}return this.m_value-=o,this.m_length=n-o,this.m_length<e.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),++t.m_symbolCount[r],0==--t.m_symbolsUntilUpdate&&t.Update(!1),r},t.ArithmeticDecoder.prototype.ExpGolombDecode=function(t,e,i){var r,o,n;r=0,o=0;do{(n=this.DecodeAdaptiveBitModel(i))&&(r+=1<<t>>>0,t++)}while(n);for(;t--;)this.DecodeStaticBitModel(e)&&(o=(o|1<<t)>>>0);return r+o},t.ArithmeticDecoder.prototype.RenormDecInterval=function(){do{this.m_value=(this.m_value<<8|this.m_codeBuffer[++this.m_acShift])>>>0,this.m_length=this.m_length<<8>>>0}while(this.m_length<e.O3DGC_AC_MIN_LENGTH)},t.ArithmeticDecoder.prototype.DecodeIntACEGC=function(t,e,i,o,n){var _=this.DecodeAdaptiveDataModel(t);return _===n&&(_+=this.ExpGolombDecode(o,e,i)),r(_)},t.ArithmeticDecoder.prototype.DecodeUIntACEGC=function(t,e,i,r,o){var n=this.DecodeAdaptiveDataModel(t);return n===o&&(n+=this.ExpGolombDecode(r,e,i)),n},t.FIFO=function(){this.m_data={},this.m_allocated=0,this.m_size=0,this.m_start=0,this.m_end=0},t.FIFO.prototype.Clear=function(){this.m_start=this.m_end=this.m_size=0},t.FIFO.prototype.GetAllocatedSize=function(){return this.m_allocated},t.FIFO.prototype.GetSize=function(){return this.m_size},t.FIFO.prototype.Allocate=function(e){return e>this.m_allocated&&(this.m_allocated=e,this.m_data=new Int32Array(this.m_allocated)),this.Clear(),t.O3DGC_OK},t.FIFO.prototype.PopFirst=function(){--this.m_size;var t=this.m_start++;return this.m_start===this.m_allocated&&(this.m_end=0),this.m_data[t]},t.FIFO.prototype.PushBack=function(t){--this.m_size,this.m_data[this.m_end]=t,++this.m_size,++this.m_end,this.m_end===this.m_allocated&&(this.m_end=0)},t.IndexedFaceSet=function(){this.m_nCoordIndex=0,this.m_nCoord=0,this.m_nNormal=0,this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_creaseAngle=30,this.m_ccw=!0,this.m_solid=!0,this.m_convex=!0,this.m_isTriangularMesh=!0,this.m_coordMin=new Float32Array(3),this.m_coordMax=new Float32Array(3),this.m_normalMin=new Float32Array(3),this.m_normalMax=new Float32Array(3),this.m_nFloatAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_nIntAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_dimFloatAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_dimIntAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_typeFloatAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_typeIntAttribute=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_minFloatAttributeBuffer=new ArrayBuffer(4*e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minFloatAttribute=new Float32Array(this.m_minFloatAttributeBuffer),this.m_maxFloatAttributeBuffer=new ArrayBuffer(4*e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_maxFloatAttribute=new Float32Array(this.m_maxFloatAttributeBuffer),this.m_coordIndex={},this.m_coord={},this.m_normal={},this.m_floatAttribute=[],this.m_intAttribute=[]},t.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},t.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},t.IndexedFaceSet.prototype.GetNCoord=function(){return this.m_nCoord},t.IndexedFaceSet.prototype.GetNNormal=function(){return this.m_nNormal},t.IndexedFaceSet.prototype.GetNFloatAttribute=function(t){return this.m_nFloatAttribute[t]},t.IndexedFaceSet.prototype.GetNIntAttribute=function(t){return this.m_nIntAttribute[t]},t.IndexedFaceSet.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},t.IndexedFaceSet.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},t.IndexedFaceSet.prototype.GetCoordMinArray=function(){return this.m_coordMin},t.IndexedFaceSet.prototype.GetCoordMaxArray=function(){return this.m_coordMax},t.IndexedFaceSet.prototype.GetNormalMinArray=function(){return this.m_normalMin},t.IndexedFaceSet.prototype.GetNormalMaxArray=function(){return this.m_normalMax},t.IndexedFaceSet.prototype.GetFloatAttributeMinArray=function(t){return new Float32Array(this.m_minFloatAttributeBuffer,t*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES*4,this.GetFloatAttributeDim(t))},t.IndexedFaceSet.prototype.GetFloatAttributeMaxArray=function(t){return new Float32Array(this.m_maxFloatAttributeBuffer,t*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES*4,this.GetFloatAttributeDim(t))},t.IndexedFaceSet.prototype.GetFloatAttributeDim=function(t){return this.m_dimFloatAttribute[t]},t.IndexedFaceSet.prototype.GetIntAttributeDim=function(t){return this.m_dimIntAttribute[t]},t.IndexedFaceSet.prototype.GetFloatAttributeType=function(t){return this.m_typeFloatAttribute[t]},t.IndexedFaceSet.prototype.GetIntAttributeType=function(t){return this.m_typeIntAttribute[t]},t.IndexedFaceSet.prototype.GetFloatAttributeMax=function(t,i){return this.m_maxFloatAttribute[t*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]},t.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},t.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},t.IndexedFaceSet.prototype.GetCCW=function(){return this.m_ccw},t.IndexedFaceSet.prototype.GetSolid=function(){return this.m_solid},t.IndexedFaceSet.prototype.GetConvex=function(){return this.m_convex},t.IndexedFaceSet.prototype.GetIsTriangularMesh=function(){return this.m_isTriangularMesh},t.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},t.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},t.IndexedFaceSet.prototype.GetCoord=function(){return this.m_coord},t.IndexedFaceSet.prototype.GetNormal=function(){return this.m_normal},t.IndexedFaceSet.prototype.GetFloatAttribute=function(t){return this.m_floatAttribute[t]},t.IndexedFaceSet.prototype.GetIntAttribute=function(t){return this.m_intAttribute[t]},t.IndexedFaceSet.prototype.SetNCoordIndex=function(t){this.m_nCoordIndex=t},t.IndexedFaceSet.prototype.SetNNormalIndex=function(t){},t.IndexedFaceSet.prototype.SetNormalPerVertex=function(t){},t.IndexedFaceSet.prototype.SetNFloatAttributeIndex=function(t){},t.IndexedFaceSet.prototype.SetNIntAttributeIndex=function(t){},t.IndexedFaceSet.prototype.SetFloatAttributePerVertex=function(t){},t.IndexedFaceSet.prototype.SetIntAttributePerVertex=function(t){},t.IndexedFaceSet.prototype.SetNCoord=function(t){this.m_nCoord=t},t.IndexedFaceSet.prototype.SetNNormal=function(t){this.m_nNormal=t},t.IndexedFaceSet.prototype.SetNumFloatAttributes=function(t){this.m_numFloatAttributes=t},t.IndexedFaceSet.prototype.SetNumIntAttributes=function(t){this.m_numIntAttributes=t},t.IndexedFaceSet.prototype.SetCreaseAngle=function(t){this.m_creaseAngle=t},t.IndexedFaceSet.prototype.SetCCW=function(t){this.m_ccw=t},t.IndexedFaceSet.prototype.SetSolid=function(t){this.m_solid=t},t.IndexedFaceSet.prototype.SetConvex=function(t){this.m_convex=t},t.IndexedFaceSet.prototype.SetIsTriangularMesh=function(t){this.m_isTriangularMesh=t},t.IndexedFaceSet.prototype.SetCoordMin=function(t,e){this.m_coordMin[t]=e},t.IndexedFaceSet.prototype.SetCoordMax=function(t,e){this.m_coordMax[t]=e},t.IndexedFaceSet.prototype.SetNormalMin=function(t,e){this.m_normalMin[t]=e},t.IndexedFaceSet.prototype.SetNormalMax=function(t,e){this.m_normalMax[t]=e},t.IndexedFaceSet.prototype.SetNFloatAttribute=function(t,e){this.m_nFloatAttribute[t]=e},t.IndexedFaceSet.prototype.SetNIntAttribute=function(t,e){this.m_nIntAttribute[t]=e},t.IndexedFaceSet.prototype.SetFloatAttributeDim=function(t,e){this.m_dimFloatAttribute[t]=e},t.IndexedFaceSet.prototype.SetIntAttributeDim=function(t,e){this.m_dimIntAttribute[t]=e},t.IndexedFaceSet.prototype.SetFloatAttributeType=function(t,e){this.m_typeFloatAttribute[t]=e},t.IndexedFaceSet.prototype.SetIntAttributeType=function(t,e){this.m_typeIntAttribute[t]=e},t.IndexedFaceSet.prototype.SetFloatAttributeMin=function(t,i,r){this.m_minFloatAttribute[t*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=r},t.IndexedFaceSet.prototype.SetFloatAttributeMax=function(t,i,r){this.m_maxFloatAttribute[t*e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=r},t.IndexedFaceSet.prototype.SetCoordIndex=function(t){this.m_coordIndex=t},t.IndexedFaceSet.prototype.SetCoord=function(t){this.m_coord=t},t.IndexedFaceSet.prototype.SetNormal=function(t){this.m_normal=t},t.IndexedFaceSet.prototype.SetFloatAttribute=function(t,e){this.m_floatAttribute[t]=e},t.IndexedFaceSet.prototype.SetIntAttribute=function(t,e){this.m_intAttribute[t]=e},t.SC3DMCEncodeParams=function(){var t;for(this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_floatAttributeQuantBits=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_floatAttributePredMode=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_intAttributePredMode=new Uint32Array(e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_encodeMode=e.O3DGC_SC3DMC_ENCODE_MODE_TFAN,this.m_streamTypeMode=e.O3DGC_STREAM_TYPE_ASCII,this.m_coordQuantBits=14,this.m_normalQuantBits=8,this.m_coordPredMode=e.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,this.m_normalPredMode=e.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION,t=0;t<e.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES;++t)this.m_floatAttributePredMode[t]=e.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION;for(t=0;t<e.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES;++t)this.m_intAttributePredMode[t]=e.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION},t.SC3DMCEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},t.SC3DMCEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},t.SC3DMCEncodeParams.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},t.SC3DMCEncodeParams.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},t.SC3DMCEncodeParams.prototype.GetCoordQuantBits=function(){return this.m_coordQuantBits},t.SC3DMCEncodeParams.prototype.GetNormalQuantBits=function(){return this.m_normalQuantBits},t.SC3DMCEncodeParams.prototype.GetFloatAttributeQuantBits=function(t){return this.m_floatAttributeQuantBits[t]},t.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},t.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},t.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(t){return this.m_floatAttributePredMode[t]},t.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(t){return this.m_intAttributePredMode[t]},t.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},t.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},t.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(t){return this.m_floatAttributePredMode[t]},t.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(t){return this.m_intAttributePredMode[t]},t.SC3DMCEncodeParams.prototype.SetStreamType=function(t){this.m_streamTypeMode=t},t.SC3DMCEncodeParams.prototype.SetEncodeMode=function(t){this.m_encodeMode=t},t.SC3DMCEncodeParams.prototype.SetNumFloatAttributes=function(t){this.m_numFloatAttributes=t},t.SC3DMCEncodeParams.prototype.SetNumIntAttributes=function(t){this.m_numIntAttributes=t},t.SC3DMCEncodeParams.prototype.SetCoordQuantBits=function(t){this.m_coordQuantBits=t},t.SC3DMCEncodeParams.prototype.SetNormalQuantBits=function(t){this.m_normalQuantBits=t},t.SC3DMCEncodeParams.prototype.SetFloatAttributeQuantBits=function(t,e){this.m_floatAttributeQuantBits[t]=e},t.SC3DMCEncodeParams.prototype.SetCoordPredMode=function(t){this.m_coordPredMode=t},t.SC3DMCEncodeParams.prototype.SetNormalPredMode=function(t){this.m_normalPredMode=t},t.SC3DMCEncodeParams.prototype.SetFloatAttributePredMode=function(t,e){this.m_floatAttributePredMode[t]=e},t.SC3DMCEncodeParams.prototype.SetIntAttributePredMode=function(t,e){this.m_intAttributePredMode[t]=e},t.AdjacencyInfo=function(){this.m_neighborsSize=0,this.m_numNeighborsSize=0,this.m_numElements=0,this.m_neighbors={},this.m_numNeighbors={}},t.AdjacencyInfo.prototype.Allocate=function(e,i){return this.m_numElements=e,i>this.m_neighborsSize&&(this.m_neighborsSize=i,this.m_neighbors=new Int32Array(this.m_neighborsSize)),e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),t.O3DGC_OK},t.AdjacencyInfo.prototype.AllocateNumNeighborsArray=function(e){return e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),this.m_numElements=e,t.O3DGC_OK},t.AdjacencyInfo.prototype.AllocateNeighborsArray=function(){var e;for(e=1;e<this.m_numElements;++e)this.m_numNeighbors[e]+=this.m_numNeighbors[e-1];return this.m_numNeighbors[this.m_numElements-1]>this.m_neighborsSize&&(this.m_neighborsSize=this.m_numNeighbors[this.m_numElements-1],this.m_neighbors=new Int32Array(this.m_neighborsSize)),t.O3DGC_OK},t.AdjacencyInfo.prototype.ClearNumNeighborsArray=function(){var e;for(e=0;e<this.m_numElements;++e)this.m_numNeighbors[e]=0;return t.O3DGC_OK},t.AdjacencyInfo.prototype.ClearNeighborsArray=function(){var e;for(e=0;e<this.m_neighborsSize;++e)this.m_neighbors[e]=-1;return t.O3DGC_OK},t.AdjacencyInfo.prototype.Begin=function(t){return t>0?this.m_numNeighbors[t-1]:0},t.AdjacencyInfo.prototype.End=function(t){return this.m_numNeighbors[t]},t.AdjacencyInfo.prototype.AddNeighbor=function(e,i){var r,o,n;for(o=this.Begin(e),n=this.End(e),r=o;r<n;++r)if(-1===this.m_neighbors[r])return this.m_neighbors[r]=i,t.O3DGC_OK;return t.O3DGC_ERROR_BUFFER_FULL},t.AdjacencyInfo.prototype.GetNeighbor=function(t){return this.m_neighbors[t]},t.AdjacencyInfo.prototype.GetNumNeighbors=function(t){return this.End(t)-this.Begin(t)},t.AdjacencyInfo.prototype.GetNumNeighborsBuffer=function(){return this.m_numNeighbors},t.AdjacencyInfo.prototype.GetNeighborsBuffer=function(){return this.m_neighbors},t.Vector=function(){this.m_data={},this.m_allocated=0,this.m_size=0},t.Vector.prototype.Clear=function(){this.m_size=0},t.Vector.prototype.Get=function(t){return this.m_data[t]},t.Vector.prototype.GetAllocatedSize=function(){return this.m_allocated},t.Vector.prototype.GetSize=function(){return this.m_size},t.Vector.prototype.GetBuffer=function(){return this.m_data},t.Vector.prototype.SetSize=function(t){this.m_size=t},t.Vector.prototype.Allocate=function(t){var e,i;if(t>this.m_allocated){if(this.m_allocated=t,i=new Int32Array(this.m_allocated),this.m_size>0)for(e=0;e<this.m_size;++e)i[e]=this.m_data[e];this.m_data=i}},t.Vector.prototype.PushBack=function(t){var i,r;if(this.m_size===this.m_allocated){if(this.m_allocated*=2,this.m_allocated<e.O3DGC_DEFAULT_VECTOR_SIZE&&(this.m_allocated=e.O3DGC_DEFAULT_VECTOR_SIZE),r=new Int32Array(this.m_allocated),this.m_size>0)for(i=0;i<this.m_size;++i)r[i]=this.m_data[i];this.m_data=r}this.m_data[this.m_size++]=t},t.CompressedTriangleFans=function(){this.m_numTFANs=new t.Vector,this.m_degrees=new t.Vector,this.m_configs=new t.Vector,this.m_operations=new t.Vector,this.m_indices=new t.Vector,this.m_trianglesOrder=new t.Vector,this.m_streamType=e.O3DGC_STREAM_TYPE_UNKOWN},t.CompressedTriangleFans.prototype.GetStreamType=function(){return this.m_streamType},t.CompressedTriangleFans.prototype.SetStreamType=function(t){this.m_streamType=t},t.CompressedTriangleFans.prototype.Clear=function(){return this.m_numTFANs.Clear(),this.m_degrees.Clear(),this.m_configs.Clear(),this.m_operations.Clear(),this.m_indices.Clear(),t.O3DGC_OK},t.CompressedTriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs.Allocate(e),this.m_degrees.Allocate(2*e),this.m_configs.Allocate(2*e),this.m_operations.Allocate(2*e),this.m_indices.Allocate(2*e),this.m_trianglesOrder.Allocate(i),this.Clear(),t.O3DGC_OK},t.CompressedTriangleFans.prototype.PushNumTFans=function(t){this.m_numTFANs.PushBack(t)},t.CompressedTriangleFans.prototype.ReadNumTFans=function(t){return this.m_numTFANs.Get(t.m_count++)},t.CompressedTriangleFans.prototype.PushDegree=function(t){this.m_degrees.PushBack(t)},t.CompressedTriangleFans.prototype.ReadDegree=function(t){return this.m_degrees.Get(t.m_count++)},t.CompressedTriangleFans.prototype.PushConfig=function(t){this.m_configs.PushBack(t)},t.CompressedTriangleFans.prototype.ReadConfig=function(t){return this.m_configs.Get(t.m_count++)},t.CompressedTriangleFans.prototype.PushOperation=function(t){this.m_operations.PushBack(t)},t.CompressedTriangleFans.prototype.ReadOperation=function(t){return this.m_operations.Get(t.m_count++)},t.CompressedTriangleFans.prototype.PushIndex=function(t){this.m_indices.PushBack(t)},t.CompressedTriangleFans.prototype.ReadIndex=function(t){return this.m_indices.Get(t.m_count++)},t.CompressedTriangleFans.prototype.PushTriangleIndex=function(t){var e;this.m_trianglesOrder.PushBack((e=t)<0?-1-2*e:2*e)},t.CompressedTriangleFans.prototype.ReadTriangleIndex=function(t){return r(this.m_trianglesOrder.Get(t.m_count++))},t.CompressedTriangleFans.prototype.LoadUIntData=function(e,i,r){var o,n;for(i.ReadUInt32ASCII(r),o=i.ReadUInt32ASCII(r),e.Allocate(o),e.Clear(),n=0;n<o;++n)e.PushBack(i.ReadUIntASCII(r));return t.O3DGC_OK},t.CompressedTriangleFans.prototype.LoadIntData=function(e,i,r){var o,n;for(i.ReadUInt32ASCII(r),o=i.ReadUInt32ASCII(r),e.Allocate(o),e.Clear(),n=0;n<o;++n)e.PushBack(i.ReadIntASCII(r));return t.O3DGC_OK},t.CompressedTriangleFans.prototype.LoadBinData=function(i,r,o){var n,_,m,a;for(r.ReadUInt32ASCII(o),n=r.ReadUInt32ASCII(o),i.Allocate(n*e.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0),i.Clear(),m=0;m<n;)for(_=r.ReadUCharASCII(o),a=0;a<e.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;++a)i.PushBack(1&_),_>>>=1,++m;return t.O3DGC_OK},t.CompressedTriangleFans.prototype.LoadUIntAC=function(e,i,r,o){var n,_,m,a,s,h,d;if(n=r.ReadUInt32Bin(o)-12,0===(_=r.ReadUInt32Bin(o)))return t.O3DGC_OK;for(m=r.ReadUInt32Bin(o),a=r.GetBuffer(o,n),o.m_count+=n,e.Allocate(_),(s=new t.ArithmeticDecoder).SetBuffer(n,a),s.StartDecoder(),(h=new t.AdaptiveDataModel).SetAlphabet(i+1),d=0;d<_;++d)e.PushBack(s.DecodeAdaptiveDataModel(h)+m);return t.O3DGC_OK},t.CompressedTriangleFans.prototype.LoadIntACEGC=function(i,r,o,n){var _,m,a,s,h,d,u,c,C,l;if(_=o.ReadUInt32Bin(n)-12,0===(m=o.ReadUInt32Bin(n)))return t.O3DGC_OK;for(a=o.ReadUInt32Bin(n)-e.O3DGC_MAX_LONG,s=o.GetBuffer(n,_),n.m_count+=_,i.Allocate(m),(h=new t.ArithmeticDecoder).SetBuffer(_,s),h.StartDecoder(),(d=new t.AdaptiveDataModel).SetAlphabet(r+2),u=new t.StaticBitModel,c=new t.AdaptiveBitModel,l=0;l<m;++l)(C=h.DecodeAdaptiveDataModel(d))===r&&(C+=h.ExpGolombDecode(0,u,c)),i.PushBack(C+a);return t.O3DGC_OK},t.CompressedTriangleFans.prototype.LoadBinAC=function(e,i,r){var o,n,_,m,a,s;if(o=i.ReadUInt32Bin(r)-8,0===(n=i.ReadUInt32Bin(r)))return t.O3DGC_OK;for(_=i.GetBuffer(r,o),r.m_count+=o,e.Allocate(n),(m=new t.ArithmeticDecoder).SetBuffer(o,_),m.StartDecoder(),a=new t.AdaptiveBitModel,s=0;s<n;++s)e.PushBack(m.DecodeAdaptiveBitModel(a));return t.O3DGC_OK},t.CompressedTriangleFans.prototype.Load=function(i,r,o,n){return n===e.O3DGC_STREAM_TYPE_ASCII?(this.LoadUIntData(this.m_numTFANs,i,r),this.LoadUIntData(this.m_degrees,i,r),this.LoadUIntData(this.m_configs,i,r),this.LoadBinData(this.m_operations,i,r),this.LoadIntData(this.m_indices,i,r),o&&this.LoadUIntData(this.m_trianglesOrder,i,r)):(this.LoadIntACEGC(this.m_numTFANs,4,i,r),this.LoadIntACEGC(this.m_degrees,16,i,r),this.LoadUIntAC(this.m_configs,10,i,r),this.LoadBinAC(this.m_operations,i,r),this.LoadIntACEGC(this.m_indices,8,i,r),o&&this.LoadIntACEGC(this.m_trianglesOrder,16,i,r)),t.O3DGC_OK},t.TriangleFans=function(){this.m_verticesAllocatedSize=0,this.m_sizeTFANAllocatedSize=0,this.m_numTFANs=0,this.m_numVertices=0,this.m_sizeTFAN={},this.m_vertices={}},t.TriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs=0,this.m_numVertices=0,this.m_verticesAllocatedSize<i&&(this.m_verticesAllocatedSize=i,this.m_vertices=new Int32Array(this.m_verticesAllocatedSize)),this.m_sizeTFANAllocatedSize<e&&(this.m_sizeTFANAllocatedSize=e,this.m_sizeTFAN=new Int32Array(this.m_sizeTFANAllocatedSize)),t.O3DGC_OK},t.TriangleFans.prototype.Clear=function(){return this.m_numTFANs=0,this.m_numVertices=0,t.O3DGC_OK},t.TriangleFans.prototype.AddVertex=function(e){var i,r;if(++this.m_numVertices,this.m_numVertices>this.m_verticesAllocatedSize){for(this.m_verticesAllocatedSize*=2,r=new Int32Array(this.m_verticesAllocatedSize),i=0;i<this.m_numVertices;++i)r[i]=this.m_vertices[i];this.m_vertices=r}return this.m_vertices[this.m_numVertices-1]=e,++this.m_sizeTFAN[this.m_numTFANs-1],t.O3DGC_OK},t.TriangleFans.prototype.AddTFAN=function(){var e,i;if(++this.m_numTFANs,this.m_numTFANs>this.m_sizeTFANAllocatedSize){for(this.m_sizeTFANAllocatedSize*=2,i=new Int32Array(this.m_sizeTFANAllocatedSize),e=0;e<this.m_numTFANs;++e)i[e]=this.m_sizeTFAN[e];this.m_sizeTFAN=i}return this.m_sizeTFAN[this.m_numTFANs-1]=this.m_numTFANs>1?this.m_sizeTFAN[this.m_numTFANs-2]:0,t.O3DGC_OK},t.TriangleFans.prototype.Begin=function(t){return t>0?this.m_sizeTFAN[t-1]:0},t.TriangleFans.prototype.End=function(t){return this.m_sizeTFAN[t]},t.TriangleFans.prototype.GetVertex=function(t){return this.m_vertices[t]},t.TriangleFans.prototype.GetTFANSize=function(t){return this.End(t)-this.Begin(t)},t.TriangleFans.prototype.GetNumTFANs=function(){return this.m_numTFANs},t.TriangleFans.prototype.GetNumVertices=function(){return this.m_numVertices},t.TriangleListDecoder=function(){this.m_itNumTFans=new t.Iterator,this.m_itDegree=new t.Iterator,this.m_itConfig=new t.Iterator,this.m_itOperation=new t.Iterator,this.m_itIndex=new t.Iterator,this.m_maxNumVertices=0,this.m_maxNumTriangles=0,this.m_numTriangles=0,this.m_numVertices=0,this.m_tempTrianglesSize=0,this.m_vertexCount=0,this.m_triangleCount=0,this.m_numConqueredTriangles=0,this.m_numVisitedVertices=0,this.m_triangles={},this.m_tempTriangles={},this.m_visitedVertices={},this.m_visitedVerticesValence={},this.m_vertexToTriangle=new t.AdjacencyInfo,this.m_ctfans=new t.CompressedTriangleFans,this.m_tfans=new t.TriangleFans,this.m_streamType=e.O3DGC_STREAM_TYPE_ASCII,this.m_decodeTrianglesOrder=!1,this.m_decodeVerticesOrder=!1,this.m_processConfig={0:function(t,e){var i;for(t.m_tfans.AddVertex(t.m_visitedVertices[0]),i=1;i<e-1;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++);t.m_tfans.AddVertex(t.m_visitedVertices[1])},1:function(t,e,i){var r,o;for(t.m_tfans.AddVertex(t.m_visitedVertices[0]),r=1;r<e-1;++r)1===t.m_ctfans.ReadOperation(t.m_itOperation)?(o=t.m_ctfans.ReadIndex(t.m_itIndex))<0?t.m_tfans.AddVertex(t.m_visitedVertices[-o-1]):t.m_tfans.AddVertex(o+i):(t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++));t.m_tfans.AddVertex(t.m_visitedVertices[1])},2:function(t,e){var i;for(i=0;i<e-1;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++);t.m_tfans.AddVertex(t.m_visitedVertices[0])},3:function(t,e){var i;for(i=0;i<e-1;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++);t.m_tfans.AddVertex(t.m_visitedVertices[1])},4:function(t,e){var i;for(t.m_tfans.AddVertex(t.m_visitedVertices[0]),i=1;i<e;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++)},5:function(t,e){var i;for(t.m_tfans.AddVertex(t.m_visitedVertices[1]),i=1;i<e;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++)},6:function(t,e){var i;for(i=0;i<e;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++)},7:function(t,e){var i;for(t.m_tfans.AddVertex(t.m_visitedVertices[1]),i=1;i<e-1;++i)t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++);t.m_tfans.AddVertex(t.m_visitedVertices[0])},8:function(t,e,i){var r,o;for(t.m_tfans.AddVertex(t.m_visitedVertices[1]),r=1;r<e-1;++r)1===t.m_ctfans.ReadOperation(t.m_itOperation)?(o=t.m_ctfans.ReadIndex(t.m_itIndex))<0?t.m_tfans.AddVertex(t.m_visitedVertices[-o-1]):t.m_tfans.AddVertex(o+i):(t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++));t.m_tfans.AddVertex(t.m_visitedVertices[0])},9:function(t,e,i){var r,o;for(r=0;r<e;++r)1===t.m_ctfans.ReadOperation(t.m_itOperation)?(o=t.m_ctfans.ReadIndex(t.m_itIndex))<0?t.m_tfans.AddVertex(t.m_visitedVertices[-o-1]):t.m_tfans.AddVertex(o+i):(t.m_visitedVertices[t.m_numVisitedVertices++]=t.m_vertexCount,t.m_tfans.AddVertex(t.m_vertexCount++))}}},t.TriangleListDecoder.prototype.GetStreamType=function(){return this.m_streamType},t.TriangleListDecoder.prototype.GetReorderTriangles=function(){return this.m_decodeTrianglesOrder},t.TriangleListDecoder.prototype.GetReorderVertices=function(){return this.m_decodeVerticesOrder},t.TriangleListDecoder.prototype.SetStreamType=function(t){this.m_streamType=t},t.TriangleListDecoder.prototype.GetVertexToTriangle=function(){return this.m_vertexToTriangle},t.TriangleListDecoder.prototype.Reorder=function(){var e,i,o,n,_,m,a,s;if(this.m_decodeTrianglesOrder)for(e=this.m_triangles,i=this.m_numTriangles,o=this.m_ctfans.m_trianglesOrder.m_data,(m=this.m_tempTriangles).set(e),n=0,_=0,s=0;s<i;++s)e[3*(a=r(o[n++])+_)]=m[3*s],e[3*a+1]=m[3*s+1],e[3*a+2]=m[3*s+2],_=a+1;return t.O3DGC_OK},t.TriangleListDecoder.prototype.CompueLocalConnectivityInfo=function(e){var i,r,o,n,_,m,a,s,h,d,u,c,C,l,A,f,p,D,S;for(i=this.m_visitedVertices,r=this.m_visitedVerticesValence,o=this.m_triangles,_=(n=this.m_vertexToTriangle).Begin(e),m=n.End(e),a=0,h=0,p=0,u=_;p>=0&&u<m;++u)if((p=n.GetNeighbor(u))>=0)for(++a,D=3*p,C=0;C<3;++C)if((S=o[D+C])>e){for(s=!1,c=0;c<h;++c){if(S===i[c]){r[c]++,s=!0;break}if(S<i[c]){for(l=++h-1;l>c;--l)i[l]=i[l-1],r[l]=r[l-1];i[c]=S,r[c]=1,s=!0;break}}s||(i[h]=S,r[h]=1,h++)}if(h>2)for(A=1;A<h;++A)if(1===r[A])for(f=A;f>0&&r[f]<r[f-1];)d=r[f],r[f]=r[f-1],r[f-1]=d,d=i[f],i[f]=i[f-1],i[f-1]=d,--f;return this.m_numConqueredTriangles=a,this.m_numVisitedVertices=h,t.O3DGC_OK},t.TriangleListDecoder.prototype.DecompressTFAN=function(e){var i,r,o,n,_,m,a,s,h,d,u,c,C,l,A,f,p,D,S;if(i=this.m_vertexToTriangle,r=this.m_triangles,o=this.m_itDegree,n=this.m_itConfig,_=this.m_tfans,a=this.m_processConfig,s=this.m_ctfans,h=this.m_triangleCount,d=this.m_numConqueredTriangles,(m=s.ReadNumTFans(this.m_itNumTFans))>0)for(D=0;D<m;++D)for(_.AddTFAN(),u=s.ReadDegree(o)+2-d,c=s.ReadConfig(n),C=_.GetNumVertices(),_.AddVertex(e),a[c](this,u,e),l=_.GetNumVertices(),A=_.GetVertex(C+1),S=C+2;S<l;++S)f=_.GetVertex(S),p=3*h,r[p++]=e,r[p++]=A,r[p]=f,i.AddNeighbor(e,h),i.AddNeighbor(A,h),i.AddNeighbor(f,h),A=f,h++;return this.m_triangleCount=h,t.O3DGC_OK},t.TriangleListDecoder.prototype.Decompress=function(){var e;for(e=0;e<this.m_numVertices;++e)e===this.m_vertexCount&&this.m_vertexCount++,this.CompueLocalConnectivityInfo(e),this.DecompressTFAN(e);return t.O3DGC_OK},t.TriangleListDecoder.prototype.Init=function(e,i,r,o){var n,_;for(this.m_numTriangles=i,this.m_numVertices=r,this.m_triangles=e,this.m_vertexCount=0,this.m_triangleCount=0,this.m_itNumTFans.m_count=0,this.m_itDegree.m_count=0,this.m_itConfig.m_count=0,this.m_itOperation.m_count=0,this.m_itIndex.m_count=0,this.m_numVertices>this.m_maxNumVertices&&(this.m_maxNumVertices=this.m_numVertices,this.m_visitedVerticesValence=new Int32Array(this.m_numVertices),this.m_visitedVertices=new Int32Array(this.m_numVertices)),this.m_decodeTrianglesOrder&&this.m_tempTrianglesSize<this.m_numTriangles&&(this.m_tempTrianglesSize=this.m_numTriangles,this.m_tempTriangles=new Int32Array(3*this.m_tempTrianglesSize)),this.m_ctfans.SetStreamType(this.m_streamType),this.m_ctfans.Allocate(this.m_numVertices,this.m_numTriangles),this.m_tfans.Allocate(2*this.m_numVertices,8*this.m_numVertices),this.m_vertexToTriangle.AllocateNumNeighborsArray(r),_=this.m_vertexToTriangle.GetNumNeighborsBuffer(),n=0;n<r;++n)_[n]=o;return this.m_vertexToTriangle.AllocateNeighborsArray(),this.m_vertexToTriangle.ClearNeighborsArray(),t.O3DGC_OK},t.TriangleListDecoder.prototype.Decode=function(e,i,r,o,n){var _,m;return _=o.ReadUChar(n,this.m_streamType),this.m_decodeTrianglesOrder=0!=(2&_),this.m_decodeVerticesOrder=0!=(1&_),this.m_decodeVerticesOrder?t.O3DGC_ERROR_NON_SUPPORTED_FEATURE:(m=o.ReadUInt32(n,this.m_streamType),this.Init(e,i,r,m),this.m_ctfans.Load(o,n,this.m_decodeTrianglesOrder,this.m_streamType),this.Decompress(),t.O3DGC_OK)},t.SC3DMCDecoder=function(){var i;for(this.m_iterator=new t.Iterator,this.m_streamSize=0,this.m_params=new t.SC3DMCEncodeParams,this.m_triangleListDecoder=new t.TriangleListDecoder,this.m_quantFloatArray={},this.m_orientation={},this.m_normals={},this.m_quantFloatArraySize=0,this.m_normalsSize=0,this.m_orientationSize=0,this.m_stats=new t.SC3DMCStats,this.m_streamType=e.O3DGC_STREAM_TYPE_UNKOWN,this.m_neighbors=[],this.m_idelta=new Float32Array(e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minNormal=new Float32Array(2),this.m_maxNormal=new Float32Array(2),this.m_minNormal[0]=this.m_minNormal[1]=-2,this.m_maxNormal[0]=this.m_maxNormal[1]=2,i=0;i<e.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES;++i)this.m_neighbors[i]=new t.SC3DMCPredictor},t.SC3DMCDecoder.prototype.GetStats=function(){return this.m_stats},t.SC3DMCDecoder.prototype.DecodeHeader=function(i,r){var o,n,_,m,a;if(o=this.m_iterator.m_count,r.ReadUInt32(this.m_iterator,e.O3DGC_STREAM_TYPE_BINARY)!==e.O3DGC_SC3DMC_START_CODE){if(this.m_iterator.m_count=o,r.ReadUInt32(this.m_iterator,e.O3DGC_STREAM_TYPE_ASCII)!==e.O3DGC_SC3DMC_START_CODE)return t.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=e.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=e.O3DGC_STREAM_TYPE_BINARY;if(this.m_streamSize=r.ReadUInt32(this.m_iterator,this.m_streamType),this.m_params.SetEncodeMode(r.ReadUChar(this.m_iterator,this.m_streamType)),i.SetCreaseAngle(r.ReadFloat32(this.m_iterator,this.m_streamType)),n=r.ReadUChar(this.m_iterator,this.m_streamType),i.SetCCW(1==(1&n)),i.SetSolid(1==(2&n)),i.SetConvex(1==(4&n)),i.SetIsTriangularMesh(1==(8&n)),i.SetNCoord(r.ReadUInt32(this.m_iterator,this.m_streamType)),i.SetNNormal(r.ReadUInt32(this.m_iterator,this.m_streamType)),i.SetNumFloatAttributes(r.ReadUInt32(this.m_iterator,this.m_streamType)),i.SetNumIntAttributes(r.ReadUInt32(this.m_iterator,this.m_streamType)),i.GetNCoord()>0){for(i.SetNCoordIndex(r.ReadUInt32(this.m_iterator,this.m_streamType)),_=0;_<3;++_)i.SetCoordMin(_,r.ReadFloat32(this.m_iterator,this.m_streamType)),i.SetCoordMax(_,r.ReadFloat32(this.m_iterator,this.m_streamType));this.m_params.SetCoordQuantBits(r.ReadUChar(this.m_iterator,this.m_streamType))}if(i.GetNNormal()>0){for(i.SetNNormalIndex(r.ReadUInt32(this.m_iterator,this.m_streamType)),_=0;_<3;++_)i.SetNormalMin(_,r.ReadFloat32(this.m_iterator,this.m_streamType)),i.SetNormalMax(_,r.ReadFloat32(this.m_iterator,this.m_streamType));i.SetNormalPerVertex(1===r.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetNormalQuantBits(r.ReadUChar(this.m_iterator,this.m_streamType))}for(m=0;m<i.GetNumFloatAttributes();++m)if(i.SetNFloatAttribute(m,r.ReadUInt32(this.m_iterator,this.m_streamType)),i.GetNFloatAttribute(m)>0){for(i.SetNFloatAttributeIndex(m,r.ReadUInt32(this.m_iterator,this.m_streamType)),a=r.ReadUChar(this.m_iterator,this.m_streamType),i.SetFloatAttributeDim(m,a),_=0;_<a;++_)i.SetFloatAttributeMin(m,_,r.ReadFloat32(this.m_iterator,this.m_streamType)),i.SetFloatAttributeMax(m,_,r.ReadFloat32(this.m_iterator,this.m_streamType));i.SetFloatAttributePerVertex(m,1===r.ReadUChar(this.m_iterator,this.m_streamType)),i.SetFloatAttributeType(m,r.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetFloatAttributeQuantBits(m,r.ReadUChar(this.m_iterator,this.m_streamType))}for(m=0;m<i.GetNumIntAttributes();++m)i.SetNIntAttribute(m,r.ReadUInt32(this.m_iterator,this.m_streamType)),i.GetNIntAttribute(m)>0&&(i.SetNIntAttributeIndex(m,r.ReadUInt32(this.m_iterator,this.m_streamType)),i.SetIntAttributeDim(m,r.ReadUChar(this.m_iterator,this.m_streamType)),i.SetIntAttributePerVertex(m,1===r.ReadUChar(this.m_iterator,this.m_streamType)),i.SetIntAttributeType(m,r.ReadUChar(this.m_iterator,this.m_streamType)));return t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodeIntArrayBinary=function(i,r,n,_,m,a,s){var h,d,u,c,C,l,A,f,p,D,S,I,T,y,O,G,M,N,R,b,E,F,x,B,g,U,V,v,P;if(p=this.m_iterator,D=this.m_streamType,I=new t.ArithmeticDecoder,T=new t.StaticBitModel,y=new t.AdaptiveBitModel,(O=new t.AdaptiveDataModel).SetAlphabet(e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS+1),M=(G=this.m_triangleListDecoder.GetVertexToTriangle()).m_neighbors,N=m.GetCoordIndex(),r*n,R=p.m_count,b=s.ReadUInt32(p,D),F=(E=s.ReadUChar(p,D))>>>4&7,a.m_value=7&E,b-=p.m_count-R,(x=new t.Iterator).m_count=p.m_count+b,0,0,new t.SC3DMCTriplet(-1,-1,-1),F!==e.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return t.O3DGC_ERROR_CORRUPTED_STREAM;for(f=s.GetBuffer(p,b),p.m_count+=b,I.SetBuffer(b,f),I.StartDecoder(),B=I.ExpGolombDecode(0,T,y),g=I.ExpGolombDecode(0,T,y),(U=new t.AdaptiveDataModel).SetAlphabet(g+2),V=this.m_neighbors,this.m_normals,v=new t.NumberRef,h=a.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION,P=0;P<r;++P){if(v.m_value=0,G.GetNumNeighbors(P)>0&&h)for(l=G.Begin(P),A=G.End(P),c=l;c<A&&!((C=M[c])<0);++c)o(N,C,P,v,V,n,i,_);if(v.m_value>1)for(d=I.DecodeAdaptiveDataModel(O),u=0;u<n;++u)S=I.DecodeIntACEGC(U,T,y,B,g),i[P*_+u]=S+V[d].m_pred[u];else if(P>0&&a.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION)for(u=0;u<n;++u)S=I.DecodeIntACEGC(U,T,y,B,g),i[P*_+u]=S+i[(P-1)*_+u];else for(u=0;u<n;++u)S=I.DecodeUIntACEGC(U,T,y,B,g),i[P*_+u]=S}return p.m_count=x.m_count,t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodeIntArrayASCII=function(i,r,n,_,m,a,s){var h,d,u,c,C,l,A,f,p,D,S,I,T,y,O,G,M,N,R,b,E;if(d=this.m_iterator,u=this.m_streamType,l=(C=this.m_triangleListDecoder.GetVertexToTriangle()).m_neighbors,A=m.GetCoordIndex(),r*n,f=d.m_count,p=s.ReadUInt32(d,u),S=(D=s.ReadUChar(d,u))>>>4&7,a.m_value=7&D,p-=d.m_count-f,(I=new t.Iterator).m_count=d.m_count+p,new t.SC3DMCTriplet(-1,-1,-1),S!==e.O3DGC_SC3DMC_BINARIZATION_ASCII)return t.O3DGC_ERROR_CORRUPTED_STREAM;for(s.ReadUInt32(I,u),T=this.m_neighbors,this.m_normals,y=new t.NumberRef,h=a.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION,O=0;O<r;++O){if(y.m_value=0,C.GetNumNeighbors(O)>0&&h)for(G=C.Begin(O),M=C.End(O),N=G;N<M&&!((R=l[N])<0);++N)o(A,R,O,y,T,n,i,_);if(y.m_value>1)for(E=s.ReadUCharASCII(I),b=0;b<n;++b)c=s.ReadIntASCII(d),i[O*_+b]=c+T[E].m_pred[b];else if(O>0&&a.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION)for(b=0;b<n;++b)c=s.ReadIntASCII(d),i[O*_+b]=c+i[(O-1)*_+b];else for(b=0;b<n;++b)c=s.ReadUIntASCII(d),i[O*_+b]=c}return d.m_count=I.m_count,t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodeIntArray=function(t,i,r,o,n,_,m){return this.m_streamType===e.O3DGC_STREAM_TYPE_ASCII?this.DecodeIntArrayASCII(t,i,r,o,n,_,m):this.DecodeIntArrayBinary(t,i,r,o,n,_,m)},t.SC3DMCDecoder.prototype.ProcessNormals=function(e){var i,r,o,n,_,m,a,s,h,d,u,c,C,l,A,f,p,D,S;for(o=e.GetNNormal(),n=3*e.GetNNormal(),this.m_normalsSize<n&&(this.m_normalsSize=n,this.m_normals=new Float32Array(this.m_normalsSize)),_=this.m_normals,m=this.m_quantFloatArray,a=this.m_orientation,function(e,i,r,o,n){var _,m,a,s,h,d,u,c,C,l;for(l=new t.Vec3,c=new t.Vec3,C=new t.Vec3,a=3*o,m=0;m<a;++m)n[m]=0;for(s=0;s<i;++s)h=3*e[_=3*s],d=3*e[_+1],u=3*e[_+2],c.m_x=r[d]-r[h],c.m_y=r[d+1]-r[h+1],c.m_z=r[d+2]-r[h+2],C.m_x=r[u]-r[h],C.m_y=r[u+1]-r[h+1],C.m_z=r[u+2]-r[h+2],l.m_x=c.m_y*C.m_z-c.m_z*C.m_y,l.m_y=c.m_z*C.m_x-c.m_x*C.m_z,l.m_z=c.m_x*C.m_y-c.m_y*C.m_x,n[h]+=l.m_x,n[h+1]+=l.m_y,n[h+2]+=l.m_z,n[d]+=l.m_x,n[d+1]+=l.m_y,n[d+2]+=l.m_z,n[u]+=l.m_x,n[u+1]+=l.m_y,n[u+2]+=l.m_z}(e.GetCoordIndex(),e.GetNCoordIndex(),m,o,_),s=new t.Vec3,h=new t.Vec3,d=0;d<o;++d)i=3*d,s.m_x=_[i],s.m_y=_[i+1],s.m_z=_[i+2],0===(l=Math.sqrt(s.m_x*s.m_x+s.m_y*s.m_y+s.m_z*s.m_z))&&(l=1),A=s,f=h,p=void 0,D=void 0,S=void 0,p=Math.abs(A.m_x),D=Math.abs(A.m_y),(S=Math.abs(A.m_z))>=p&&S>=D?A.m_z>=0?(f.m_z=0,f.m_x=A.m_x,f.m_y=A.m_y):(f.m_z=1,f.m_x=-A.m_x,f.m_y=-A.m_y):D>=p&&D>=S?A.m_y>=0?(f.m_z=2,f.m_x=A.m_z,f.m_y=A.m_x):(f.m_z=3,f.m_x=-A.m_z,f.m_y=-A.m_x):A.m_x>=0?(f.m_z=4,f.m_x=A.m_y,f.m_y=A.m_z):(f.m_z=5,f.m_x=-A.m_y,f.m_y=-A.m_z),u=h.m_x/l,c=h.m_y/l,C=h.m_z+a[d],a[d]=C,C>>>1!=h.m_z>>>1&&(u=0,c=0),_[r=2*d]=u,_[r+1]=c;return t.O3DGC_OK},t.SC3DMCDecoder.prototype.IQuantize=function(i,r,o,n,_,m,a,s){var h,d,u,c,C,l;if(s.m_value===e.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION)for(l=e.CubeToSphere,c=this.m_orientation,C=this.m_normals,d=new t.Vec3(0,0,0),u=new t.Vec3(0,0,0),this.IQuantizeFloatArray(i,r,o,n,this.m_minNormal,this.m_maxNormal,a+1),h=0;h<r;++h)d.m_x=i[n*h]+C[2*h],d.m_y=i[n*h+1]+C[2*h+1],d.m_z=c[h],l[d.m_z](d,u),i[n*h]=u.m_x,i[n*h+1]=u.m_y,i[n*h+2]=u.m_z;else this.IQuantizeFloatArray(i,r,o,n,_,m,a)},t.SC3DMCDecoder.prototype.DecodeFloatArrayBinary=function(i,_,m,a,s,h,d,u,c,C){var l,A,f,p,D,S,I,T,y,O,G,M,N,R,b,E,F,x,B,g,U,V,v,P,z,w,L,Y,X,H,K,q,Q,Z,k;if(E=this.m_iterator,F=this.m_orientation,x=this.m_streamType,g=new t.ArithmeticDecoder,U=new t.StaticBitModel,V=new t.AdaptiveBitModel,v=new t.AdaptiveDataModel,l=e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,v.SetAlphabet(l+1),z=(P=this.m_triangleListDecoder.GetVertexToTriangle()).m_neighbors,w=u.GetCoordIndex(),L=_*m,Y=E.m_count,X=C.ReadUInt32(E,x),K=(H=C.ReadUChar(E,x))>>>4&7,c.m_value=7&H,X-=E.m_count-Y,(q=new t.Iterator).m_count=E.m_count+X,0,0,K!==e.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return t.O3DGC_ERROR_CORRUPTED_STREAM;if(S=C.GetBuffer(E,X),E.m_count+=X,g.SetBuffer(X,S),g.StartDecoder(),Q=g.ExpGolombDecode(0,U,V),Z=g.ExpGolombDecode(0,U,V),(k=new t.AdaptiveDataModel).SetAlphabet(Z+2),c.m_value===e.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(this.m_orientationSize<L&&(this.m_orientationSize=L,this.m_orientation=new Int8Array(this.m_orientationSize),F=this.m_orientation),(D=new t.AdaptiveDataModel).SetAlphabet(12),G=0;G<_;++G)F[G]=r(g.DecodeAdaptiveDataModel(D));this.ProcessNormals(u),m=2}for(this.m_quantFloatArraySize<L&&(this.m_quantFloatArraySize=L,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),I=this.m_quantFloatArray,T=this.m_neighbors,this.m_normals,y=new t.NumberRef,A=c.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION,f=c.m_value===e.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,M=0;M<_;++M){if(y.m_value=0,P.GetNumNeighbors(M)>0&&A){if(R=P.Begin(M),b=P.End(M),f)for(N=R;N<b&&!((O=z[N])<0);++N)n(w,O,M,y,T,m,I,a,P,z);if(y.m_value<l)for(N=R;N<b&&!((O=z[N])<0);++N)o(w,O,M,y,T,m,I,a)}if(y.m_value>1)for(p=g.DecodeAdaptiveDataModel(v),G=0;G<m;++G)B=g.DecodeIntACEGC(k,U,V,Q,Z),I[M*a+G]=B+T[p].m_pred[G];else if(M>0&&A)for(G=0;G<m;++G)B=g.DecodeIntACEGC(k,U,V,Q,Z),I[M*a+G]=B+I[(M-1)*a+G];else for(G=0;G<m;++G)B=g.DecodeUIntACEGC(k,U,V,Q,Z),I[M*a+G]=B}return E.m_count=q.m_count,this.IQuantize(i,_,m,a,s,h,d,c),t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodeFloatArrayASCII=function(i,r,_,m,a,s,h,d,u,c){var C,l,A,f,p,D,S,I,T,y,O,G,M,N,R,b,E,F,x,B,g,U,V,v,P,z;if(C=e.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,f=this.m_iterator,p=this.m_orientation,D=this.m_streamType,T=(I=this.m_triangleListDecoder.GetVertexToTriangle()).m_neighbors,y=d.GetCoordIndex(),O=r*_,G=f.m_count,M=c.ReadUInt32(f,D),R=(N=c.ReadUChar(f,D))>>>4&7,u.m_value=7&N,M-=f.m_count-G,(b=new t.Iterator).m_count=f.m_count+M,R!==e.O3DGC_SC3DMC_BINARIZATION_ASCII)return t.O3DGC_ERROR_CORRUPTED_STREAM;if(c.ReadUInt32(b,D),u.m_value===e.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(this.m_orientationSize<r&&(this.m_orientationSize=r,this.m_orientation=new Int8Array(this.m_orientationSize),p=this.m_orientation),P=0;P<r;++P)p[P]=c.ReadIntASCII(f);this.ProcessNormals(d),_=2}for(this.m_quantFloatArraySize<O&&(this.m_quantFloatArraySize=O,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),E=this.m_quantFloatArray,F=this.m_neighbors,this.m_normals,x=new t.NumberRef,l=u.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION,A=u.m_value===e.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,B=0;B<r;++B){if(x.m_value=0,I.GetNumNeighbors(B)>0&&l){if(U=I.Begin(B),V=I.End(B),A)for(g=U;g<V&&!((v=T[g])<0);++g)n(y,v,B,x,F,_,E,m,I,T);if(x.m_value<C)for(g=U;g<V&&!((v=T[g])<0);++g)o(y,v,B,x,F,_,E,m)}if(x.m_value>1)for(z=c.ReadUCharASCII(b),P=0;P<_;++P)S=c.ReadIntASCII(f),E[B*m+P]=S+F[z].m_pred[P];else if(B>0&&u.m_value!==e.O3DGC_SC3DMC_NO_PREDICTION)for(P=0;P<_;++P)S=c.ReadIntASCII(f),E[B*m+P]=S+E[(B-1)*m+P];else for(P=0;P<_;++P)S=c.ReadUIntASCII(f),E[B*m+P]=S}return f.m_count=b.m_count,this.IQuantize(i,r,_,m,a,s,h,u),t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodeFloatArray=function(t,i,r,o,n,_,m,a,s,h){return this.m_streamType===e.O3DGC_STREAM_TYPE_ASCII?this.DecodeFloatArrayASCII(t,i,r,o,n,_,m,a,s,h):this.DecodeFloatArrayBinary(t,i,r,o,n,_,m,a,s,h)},t.SC3DMCDecoder.prototype.IQuantizeFloatArray=function(e,i,r,o,n,_,m){var a,s,h,d,u;for(a=this.m_idelta,s=this.m_quantFloatArray,h=0;h<r;++h)d=_[h]-n[h],a[h]=d>0?d/((1<<m>>>0)-1):1;for(u=0;u<i;++u)for(h=0;h<r;++h)e[u*o+h]=s[u*o+h]*a[h]+n[h];return t.O3DGC_OK},t.SC3DMCDecoder.prototype.DecodePlayload=function(e,i){var r,o,n,_,m,a,s;if(r=this.m_params,o=this.m_iterator,n=this.m_stats,_=new t.NumberRef,m=new t.Timer,a=t.O3DGC_OK,this.m_triangleListDecoder.SetStreamType(this.m_streamType),n.m_streamSizeCoordIndex=o.m_count,m.Tic(),this.m_triangleListDecoder.Decode(e.GetCoordIndex(),e.GetNCoordIndex(),e.GetNCoord(),i,o),m.Toc(),n.m_timeCoordIndex=m.GetElapsedTime(),n.m_streamSizeCoordIndex=o.m_count-n.m_streamSizeCoordIndex,n.m_streamSizeCoord=o.m_count,m.Tic(),e.GetNCoord()>0&&(a=this.DecodeFloatArray(e.GetCoord(),e.GetNCoord(),3,3,e.GetCoordMinArray(),e.GetCoordMaxArray(),r.GetCoordQuantBits(),e,_,i),r.SetCoordPredMode(_.m_value)),a!==t.O3DGC_OK)return a;if(m.Toc(),n.m_timeCoord=m.GetElapsedTime(),n.m_streamSizeCoord=o.m_count-n.m_streamSizeCoord,n.m_streamSizeNormal=o.m_count,m.Tic(),e.GetNNormal()>0&&(a=this.DecodeFloatArray(e.GetNormal(),e.GetNNormal(),3,3,e.GetNormalMinArray(),e.GetNormalMaxArray(),r.GetNormalQuantBits(),e,_,i),r.SetNormalPredMode(_.m_value)),a!==t.O3DGC_OK)return a;for(m.Toc(),n.m_timeNormal=m.GetElapsedTime(),n.m_streamSizeNormal=o.m_count-n.m_streamSizeNormal,s=0;s<e.GetNumFloatAttributes();++s)n.m_streamSizeFloatAttribute[s]=o.m_count,m.Tic(),a=this.DecodeFloatArray(e.GetFloatAttribute(s),e.GetNFloatAttribute(s),e.GetFloatAttributeDim(s),e.GetFloatAttributeDim(s),e.GetFloatAttributeMinArray(s),e.GetFloatAttributeMaxArray(s),r.GetFloatAttributeQuantBits(s),e,_,i),r.SetFloatAttributePredMode(s,_.m_value),m.Toc(),n.m_timeFloatAttribute[s]=m.GetElapsedTime(),n.m_streamSizeFloatAttribute[s]=o.m_count-n.m_streamSizeFloatAttribute[s];if(a!==t.O3DGC_OK)return a;for(s=0;s<e.GetNumIntAttributes();++s)n.m_streamSizeIntAttribute[s]=o.m_count,m.Tic(),a=this.DecodeIntArray(e.GetIntAttribute(s),e.GetNIntAttribute(s),e.GetIntAttributeDim(s),e.GetIntAttributeDim(s),e,_,i),r.SetIntAttributePredMode(s,_.m_value),m.Toc(),n.m_timeIntAttribute[s]=m.GetElapsedTime(),n.m_streamSizeIntAttribute[s]=o.m_count-n.m_streamSizeIntAttribute[s];return a!==t.O3DGC_OK?a:(m.Tic(),this.m_triangleListDecoder.Reorder(),m.Toc(),n.m_timeReorder=m.GetElapsedTime(),a)},t.DVEncodeParams=function(){this.m_encodeMode=e.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT,this.m_streamTypeMode=e.O3DGC_STREAM_TYPE_ASCII,this.m_quantBits=10},t.DVEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},t.DVEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},t.DVEncodeParams.prototype.GetQuantBits=function(){return this.m_quantBits},t.DVEncodeParams.prototype.SetStreamType=function(t){this.m_streamTypeMode=t},t.DVEncodeParams.prototype.SetEncodeMode=function(t){this.m_encodeMode=t},t.DVEncodeParams.prototype.SetQuantBits=function(t){this.m_quantBits=t},t.DynamicVector=function(){this.m_num=0,this.m_dim=0,this.m_stride=0,this.m_max={},this.m_min={},this.m_vectors={}},t.DynamicVector.prototype.GetNVector=function(){return this.m_num},t.DynamicVector.prototype.GetDimVector=function(){return this.m_dim},t.DynamicVector.prototype.GetStride=function(){return this.m_stride},t.DynamicVector.prototype.GetMinArray=function(){return this.m_min},t.DynamicVector.prototype.GetMaxArray=function(){return this.m_max},t.DynamicVector.prototype.GetVectors=function(){return this.m_vectors},t.DynamicVector.prototype.GetMin=function(t){return this.m_min[t]},t.DynamicVector.prototype.GetMax=function(t){return this.m_max[t]},t.DynamicVector.prototype.SetNVector=function(t){this.m_num=t},t.DynamicVector.prototype.SetDimVector=function(t){this.m_dim=t},t.DynamicVector.prototype.SetStride=function(t){this.m_stride=t},t.DynamicVector.prototype.SetMinArray=function(t){this.m_min=t},t.DynamicVector.prototype.SetMaxArray=function(t){this.m_max=t},t.DynamicVector.prototype.SetMin=function(t,e){this.m_min[t]=e},t.DynamicVector.prototype.SetMax=function(t,e){this.m_max[t]=e},t.DynamicVector.prototype.SetVectors=function(t){this.m_vectors=t},t.DynamicVectorDecoder=function(){this.m_streamSize=0,this.m_maxNumVectors=0,this.m_numVectors=0,this.m_dimVectors=0,this.m_quantVectors={},this.m_iterator=new t.Iterator,this.m_streamType=e.O3DGC_STREAM_TYPE_UNKOWN,this.m_params=new t.DVEncodeParams},t.DynamicVectorDecoder.prototype.GetStreamType=function(){return this.m_streamType},t.DynamicVectorDecoder.prototype.GetIterator=function(){return this.m_iterator},t.DynamicVectorDecoder.prototype.SetStreamType=function(t){this.m_streamType=t},t.DynamicVectorDecoder.prototype.SetIterator=function(t){this.m_iterator=t},t.DynamicVectorDecoder.prototype.IUpdate=function(e,i,r){var o,n;for(n=r-1,o=2,e[i]-=e[i+1]>>1;o<n;)e[i+o]-=e[i+o-1]+e[i+o+1]+2>>2,o+=2;return o===n&&(e[i+o]-=e[i+o-1]>>1),t.O3DGC_OK},t.DynamicVectorDecoder.prototype.IPredict=function(e,i,r){var o,n;for(n=r-1,o=1;o<n;)e[i+o]+=e[i+o-1]+e[i+o+1]+1>>1,o+=2;return o===n&&(e[i+o]+=e[i+o-1]),t.O3DGC_OK},t.DynamicVectorDecoder.prototype.Merge=function(e,i,r){var o,n,_,m,a;for(_=(n=(r>>1)+(1&r))-1,m=n;_>0;){for(o=_;o<m;o+=2)a=e[i+o],e[i+o]=e[i+o+1],e[i+o+1]=a;--_,++m}return t.O3DGC_OK},t.DynamicVectorDecoder.prototype.ITransform=function(e,i,r){var o,n,_,m;for(n=0,_=0,n+=(1&(o=r))<<_++>>>0;o>1;)n+=(1&(o=(o>>1)+((1&o)>>>0)))<<_++>>>0;for(m=_-2;m>=0;--m)o=(o<<1>>>0)-(n>>>m&1)>>>0,this.Merge(e,i,o),this.IUpdate(e,i,o),this.IPredict(e,i,o);return t.O3DGC_OK},t.DynamicVectorDecoder.prototype.IQuantize=function(e,i,r,o,n,_,m){var a,s,h,d,u;for(a=this.m_quantVectors,i*r,d=0;d<r;++d)for(h=(s=_[d]-n[d])>0?s/((1<<m>>>0)-1):1,u=0;u<i;++u)e[u*o+d]=a[u+d*i]*h+n[d];return t.O3DGC_OK},t.DynamicVectorDecoder.prototype.DecodeHeader=function(i,r){var o,n,_;if(n=(o=this.m_iterator).m_count,r.ReadUInt32(o,e.O3DGC_STREAM_TYPE_BINARY)!==e.O3DGC_DV_START_CODE){if(o.m_count=n,r.ReadUInt32(o,e.O3DGC_STREAM_TYPE_ASCII)!==e.O3DGC_DV_START_CODE)return t.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=e.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=e.O3DGC_STREAM_TYPE_BINARY;return _=this.m_streamType,this.m_streamSize=r.ReadUInt32(o,_),this.m_params.SetEncodeMode(r.ReadUChar(o,_)),i.SetNVector(r.ReadUInt32(o,_)),i.GetNVector()>0&&(i.SetDimVector(r.ReadUInt32(o,_)),this.m_params.SetQuantBits(r.ReadUChar(o,_))),t.O3DGC_OK},t.DynamicVectorDecoder.prototype.DecodePlayload=function(i,r){var o,n,_,m,a,s,h,d,u,c,C,l,A,f,p,D,S,I,T;for(n=this.m_iterator,_=this.m_streamType,m=t.O3DGC_OK,a=n.m_count,s=r.ReadUInt32(n,_),o=(h=i.GetDimVector())*(d=i.GetNVector()),u=0;u<i.GetDimVector();++u)i.SetMin(u,r.ReadFloat32(n,_)),i.SetMax(u,r.ReadFloat32(n,_));if(c=new t.ArithmeticDecoder,C=new t.StaticBitModel,l=new t.AdaptiveBitModel,s-=n.m_count-a,A=0,f=0,_===e.O3DGC_STREAM_TYPE_BINARY&&(p=r.GetBuffer(n,s),n.m_count+=s,c.SetBuffer(s,p),c.StartDecoder(),A=c.ExpGolombDecode(0,C,l),f=c.ExpGolombDecode(0,C,l)),(D=new t.AdaptiveDataModel).SetAlphabet(f+2),this.m_maxNumVectors<o&&(this.m_maxNumVectors=o,this.m_quantVectors=new Int32Array(this.m_maxNumVectors)),S=this.m_quantVectors,_===e.O3DGC_STREAM_TYPE_ASCII)for(I=0;I<d;++I)for(T=0;T<h;++T)S[T*d+I]=r.ReadIntASCII(n);else for(I=0;I<d;++I)for(T=0;T<h;++T)S[T*d+I]=c.DecodeIntACEGC(D,C,l,A,f);for(T=0;T<h;++T)this.ITransform(S,T*d,d);return this.IQuantize(i.GetVectors(),d,h,i.GetStride(),i.GetMinArray(),i.GetMaxArray(),this.m_params.GetQuantBits()),m},t}();