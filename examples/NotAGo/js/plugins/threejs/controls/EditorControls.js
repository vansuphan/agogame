THREE.EditorControls=function(e,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3,this.panSpeed=.001,this.zoomSpeed=.1,this.rotationSpeed=.005;var o=this,n=new THREE.Vector3,s=new THREE.Vector3,i=new THREE.Box3,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},a=r.NONE,c=this.center,p=new THREE.Matrix3,u=new THREE.Vector2,E=new THREE.Vector2,d=new THREE.Spherical,v={type:"change"};function l(e){!1!==o.enabled&&(0===e.button?a=r.ROTATE:1===e.button?a=r.ZOOM:2===e.button&&(a=r.PAN),E.set(e.clientX,e.clientY),t.addEventListener("mousemove",m,!1),t.addEventListener("mouseup",h,!1),t.addEventListener("mouseout",h,!1),t.addEventListener("dblclick",h,!1))}function m(e){if(!1!==o.enabled){u.set(e.clientX,e.clientY);var t=u.x-E.x,n=u.y-E.y;a===r.ROTATE?o.rotate(s.set(-t*o.rotationSpeed,-n*o.rotationSpeed,0)):a===r.ZOOM?o.zoom(s.set(0,0,n)):a===r.PAN&&o.pan(s.set(-t,n,0)),E.set(e.clientX,e.clientY)}}function h(e){t.removeEventListener("mousemove",m,!1),t.removeEventListener("mouseup",h,!1),t.removeEventListener("mouseout",h,!1),t.removeEventListener("dblclick",h,!1),a=r.NONE}function T(e){e.preventDefault(),o.zoom(s.set(0,0,e.deltaY>0?1:-1))}function g(e){e.preventDefault()}this.focus=function(t){var n;i.setFromObject(t),!1===i.isEmpty()?(c.copy(i.getCenter()),n=i.getBoundingSphere().radius):(c.setFromMatrixPosition(t.matrixWorld),n=.1),s.set(0,0,1),s.applyQuaternion(e.quaternion),s.multiplyScalar(4*n),e.position.copy(c).add(s),o.dispatchEvent(v)},this.pan=function(t){var n=e.position.distanceTo(c);t.multiplyScalar(n*o.panSpeed),t.applyMatrix3(p.getNormalMatrix(e.matrix)),e.position.add(t),c.add(t),o.dispatchEvent(v)},this.zoom=function(t){var n=e.position.distanceTo(c);t.multiplyScalar(n*o.zoomSpeed),t.length()>n||(t.applyMatrix3(p.getNormalMatrix(e.matrix)),e.position.add(t),o.dispatchEvent(v))},this.rotate=function(t){n.copy(e.position).sub(c),d.setFromVector3(n),d.theta+=t.x,d.phi+=t.y,d.makeSafe(),n.setFromSpherical(d),e.position.copy(c).add(n),e.lookAt(c),o.dispatchEvent(v)},this.dispose=function(){t.removeEventListener("contextmenu",g,!1),t.removeEventListener("mousedown",l,!1),t.removeEventListener("wheel",T,!1),t.removeEventListener("mousemove",m,!1),t.removeEventListener("mouseup",h,!1),t.removeEventListener("mouseout",h,!1),t.removeEventListener("dblclick",h,!1),t.removeEventListener("touchstart",R,!1),t.removeEventListener("touchmove",w,!1)},t.addEventListener("contextmenu",g,!1),t.addEventListener("mousedown",l,!1),t.addEventListener("wheel",T,!1);var y=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],f=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],L=null;function R(e){if(!1!==o.enabled){switch(e.touches.length){case 1:y[0].set(e.touches[0].pageX,e.touches[0].pageY,0),y[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:y[0].set(e.touches[0].pageX,e.touches[0].pageY,0),y[1].set(e.touches[1].pageX,e.touches[1].pageY,0),L=y[0].distanceTo(y[1])}f[0].copy(y[0]),f[1].copy(y[1])}}function w(e){if(!1!==o.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:y[0].set(e.touches[0].pageX,e.touches[0].pageY,0),y[1].set(e.touches[0].pageX,e.touches[0].pageY,0),o.rotate(y[0].sub(r(y[0],f)).multiplyScalar(-o.rotationSpeed));break;case 2:y[0].set(e.touches[0].pageX,e.touches[0].pageY,0),y[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var t=y[0].distanceTo(y[1]);o.zoom(s.set(0,0,L-t)),L=t;var n=y[0].clone().sub(r(y[0],f)),i=y[1].clone().sub(r(y[1],f));n.x=-n.x,i.x=-i.x,o.pan(n.add(i).multiplyScalar(.5))}f[0].copy(y[0]),f[1].copy(y[1])}function r(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}}t.addEventListener("touchstart",R,!1),t.addEventListener("touchmove",w,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EditorControls.prototype.constructor=THREE.EditorControls;